<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KGO Engineering Project Calculator - Refactored</title>
    
    <!-- External CSS -->
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/responsive.css">
    <link rel="stylesheet" href="styles/components.css">
    
    <!-- External Dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/exceljs@4.4.0/dist/exceljs.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Project Header -->
        <div class="project-header">
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 8px; padding: 8px 12px;">
                <!-- Logo and App Name -->
                <div style="display: flex; align-items: center; gap: 12px; min-width: 200px;">
                    <img src="TEDevLOGO-v1.gif" alt="TE Development Logo" style="height: 40px; width: auto; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <div style="display: flex; flex-direction: column; gap: 2px;">
                        <div class="app-name" style="font-size: 20px; font-weight: 700; color: #2c3e50; white-space: nowrap; text-shadow: 0 1px 2px rgba(0,0,0,0.1);">
                            KGO Project Tool
                        </div>
                        <div style="font-size: 12px; font-weight: 500; color: #7f8c8d; white-space: nowrap;">
                            Engineering Project Calculator
                        </div>
                    </div>
                </div>
                
                <!-- Project Info Fields -->
                <div style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap; flex: 1; justify-content: center;">
                    <input type="text" id="projectNameDisplay" placeholder="Project Name" style="width: 140px; min-width: 120px; font-size: 16px; font-weight: bold;">
                    <input type="text" id="projectDescriptionDisplay" placeholder="Description" style="width: 180px; min-width: 160px; font-size: 16px; font-weight: bold;">
                    <div style="display: flex; align-items: center; gap: 3px;">
                        <label style="font-size: 16px; font-weight: bold;">Rev:</label>
                        <input type="text" id="projectRevisionDisplay" placeholder="1.0" style="width: 55px; font-size: 16px; font-weight: bold;">
                    </div>
                    <input type="date" id="projectDateDisplay" style="width: 120px; font-size: 16px; font-weight: bold;">
                    <input type="date" id="projectEndDateDisplay" style="width: 120px; font-size: 16px; font-weight: bold;">
                </div>
                
                <!-- Action Buttons -->
                <div style="display: flex; gap: 6px; flex-wrap: wrap; min-width: 200px; justify-content: flex-end;">
                    <button id="exportBtn" class="btn btn-success btn-small">üìÑ Export</button>
                    <button id="saveBtn" class="btn btn-primary btn-small">üíæ Save</button>
                    <button id="loadBtn" class="btn btn-warning btn-small">üìÇ Load</button>
                    <button id="refreshBtn" class="btn btn-info btn-small" onclick="refreshAll()" title="Refresh all calculations and UI elements">üîÑ Refresh</button>
                </div>
            </div>
        </div>

        <div class="main-layout">
            <!-- Left Panel: Results and Controls -->
            <div class="left-panel">
                <!-- Project Summary -->
                <div class="results" id="results">
                    <h2>üìä Project Summary</h2>
                    <div class="results-grid">
                        <div class="result-card" data-card-type="total-cables">
                            <h4>üîå Total Cables</h4>
                            <div class="result-value" id="totalCables">0</div>
                            <div class="result-detail">cables to install</div>
                        </div>
                        
                        <div class="result-card">
                            <h4>üîå Total Terminations</h4>
                            <div class="result-value" id="totalTerminations">0</div>
                            <div class="result-detail">connections to complete</div>
                        </div>
                        
                        <div class="result-card">
                            <h4>‚è±Ô∏è Termination Time</h4>
                            <div class="result-value" id="terminationHours">0.0 hrs</div>
                            <div class="result-detail" id="terminationDetails">0.0 minutes</div>
                        </div>
                        
                        <div class="result-card">
                            <h4>üìÖ Project Duration</h4>
                            <div class="result-value" id="projectDays">0.0 days</div>
                            <div class="result-detail" id="totalHours">0 total hours</div>
                        </div>
                        
                        <div class="result-card">
                            <h4>üí∞ Labor Cost</h4>
                            <div class="result-value" id="laborCost">$0</div>
                            <div class="result-detail" id="laborDetails">No labor allocated</div>
                        </div>
                        
                        <div class="result-card">
                            <h4>üè∑Ô∏è Orders</h4>
                            <div class="result-value" id="activeVendorTotal">$0</div>
                            <div class="result-detail" id="vendorOrdersDetail">0 orders</div>
                            <div class="result-caption" id="vendorOrdersBreakdown">
                                <div style="display: flex; flex-direction: column; gap: 2px; font-size: 0.85em; margin-top: 4px;">
                                    <!-- Vendor breakdown will be populated by JavaScript -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="result-card">
                            <h4>üì¶ Supplies & Expendables</h4>
                            <div class="result-value" id="suppliesCost">$0</div>
                            <div class="result-detail">consumables, expendables, supplies</div>
                        </div>
                        
                        <div class="result-card">
                            <h4>üìã Quotes</h4>
                            <div class="result-value" id="vendorQuotesTotal">$0</div>
                            <div class="result-detail" id="vendorQuotesDetail">0 quotes</div>
                            <div class="result-caption" id="vendorQuotesBreakdown">
                                <div style="display: flex; justify-content: space-between; font-size: 0.85em; margin-top: 8px;">
                                    <span>üìã Pending: <span id="pendingQuotesTotal">$0</span></span>
                                    <span>‚úÖ Approved: <span id="approvedQuotesTotal">$0</span></span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="result-card">
                            <h4>üë• Staff Hours</h4>
                            <div class="result-value" id="staffHoursTotal">0.0</div>
                            <div class="result-detail">total staff hours</div>
                            <div class="result-caption" id="staffHoursCaption"></div>
                        </div>
                        
                        <div class="result-card">
                            <h4>üì¶ Cable Spools</h4>
                            <div class="result-value" id="spoolsRequired">0</div>
                            <div class="result-detail" id="spoolDetails">0ft needed + 0% waste</div>
                        </div>
                        
                        <!-- <div class="result-card">
                            <h4>üèóÔ∏è Materials & Hardware</h4>
                            <div class="result-value" id="materialsCost">$0</div>
                            <div class="result-detail">rack hardware, connectors, tools</div>
                        </div>
                        
                        <div class="result-card">
                            <h4>üîß Equipment & Tools</h4>
                            <div class="result-value" id="equipmentCost">$0</div>
                            <div class="result-detail">test equipment, specialized tools</div>
                        </div> -->
                        

                        
                        <!-- <div class="result-card">
                            <h4>üöö Shipping & Logistics</h4>
                            <div class="result-value" id="shippingCost">$0</div>
                            <div class="result-detail">freight, delivery, handling</div>
                        </div>
                        
                        <div class="result-card">
                            <h4>üìã Documentation & Admin</h4>
                            <div class="result-value" id="adminCost">$0</div>
                            <div class="result-detail">permits, documentation, admin</div>
                        </div> -->
                        
                        <div class="result-card">
                            <h4>üíµ Total Project Cost</h4>
                            <div class="result-value" id="totalCost">$0</div>
                            <div class="result-detail">labor + supplies & expendables + quotes + orders + materials + equipment + shipping + admin</div>
                        </div>
                    </div>
                </div>
                
                                 <!-- Time Breakdown -->
                 <div class="input-group">
                     <h3 class="section-header" data-section="timeBreakdown">
                         <span class="toggle-icon">‚ñ∂</span> üîç Time Breakdown
                     </h3>
                     <div id="timeBreakdown" class="section-content">
                         <div class="breakdown-item">
                             <span>Termination Work:</span>
                             <span id="breakdownTermination">0.0 hours</span>
                         </div>
                         <div class="breakdown-item">
                             <span>Cable Running:</span>
                             <span id="breakdownRunning">0.0 hours</span>
                         </div>
                         <div class="breakdown-item">
                             <span>Testing & Verification:</span>
                             <span id="breakdownTesting">0.0 hours</span>
                         </div>
                         <div class="breakdown-item">
                             <span>Labeling:</span>
                             <span id="breakdownLabeling">0.0 hours</span>
                         </div>
                         <div class="breakdown-item">
                             <span>Cleanup:</span>
                             <span id="breakdownCleanup">0.0 hours</span>
                         </div>
                         <div class="breakdown-item">
                             <span>Cutover:</span>
                             <span id="breakdownCutover">0.0 hours</span>
                         </div>
                         <div class="breakdown-item">
                             <span>Decommissioning:</span>
                             <span id="breakdownDecommissioning">0.0 hours</span>
                         </div>
                         <div class="breakdown-item">
                             <span>Rack Setup:</span>
                             <span id="breakdownRack">0.0 hours</span>
                         </div>
                         <div class="breakdown-item" style="border-top: 2px solid #495057; margin-top: 10px; padding-top: 10px; color: #495057;">
                             <strong>Total Project Time:</strong>
                             <strong id="breakdownTotal">0.0 hours</strong>
                         </div>
                     </div>
                 </div>
                 
                 <!-- Reconciliation Report -->
                 <div class="input-group">
                     <h3 class="section-header" data-section="reconciliationSection" style="position: relative;">
                         <span class="toggle-icon">‚ñ∂</span> üîÑ Reconciliation Report
                         <span id="reconciliationStatus" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); font-size: 12px; padding: 2px 6px; border-radius: 10px; background: #95a5a6; color: white;">Not Run</span>
                         <span id="reconciliationFlag" style="position: absolute; right: 80px; top: 50%; transform: translateY(-50%); font-size: 12px; padding: 2px 6px; border-radius: 10px; background: #95a5a6; color: white; font-weight: bold;">Not Run</span>
                     </h3>
                     <div id="reconciliationSection" class="section-content" style="background: white !important;">
                         <!-- Action Buttons -->
                         <div style="display: flex; gap: 8px; margin-bottom: 15px; flex-wrap: wrap;">
                             <button id="runReconciliationBtn" class="btn btn-primary btn-small">üîÑ Run Report</button>
                             <button id="showHistoryBtn" class="btn btn-warning btn-small">üìã History</button>
                             <button id="exportAllBtn" class="btn btn-success btn-small">üìÑ Export All</button>
                             <button id="exportCurrentBtn" class="btn btn-success btn-small">üìë Export Current</button>
                         </div>
                         
                         <!-- Quick Status -->
                         <div id="reconciliationSummary" style="background: #f8f9fa; padding: 10px; border-radius: 6px; margin-bottom: 15px; border-left: 4px solid #3498db;">
                             <strong style="color: #495057;">Quick Status:</strong>
                             <div id="reconciliationQuickStatus" style="color: #495057;">Run reconciliation to see status</div>
                         </div>
                         
                         <!-- Report Display -->
                         <div id="reconciliationReport" style="background: white; border: 1px solid #ddd; border-radius: 6px; padding: 12px; font-family: monospace; font-size: 13px; white-space: pre-wrap; max-height: 300px; overflow-y: auto; color: #495057;">
                         </div>
                         
                         <!-- History View -->
                         <div id="reconciliationHistoryView" style="display: none;">
                             <h4 style="margin: 15px 0 10px 0; font-size: 14px; color: #495057;">Recent Reconciliations:</h4>
                             <div id="reconciliationHistoryList" style="background: white; border: 1px solid #ddd; border-radius: 6px; padding: 12px; font-family: monospace; font-size: 13px; white-space: pre-wrap; max-height: 250px; overflow-y: auto; color: #495057;">
                                 No reconciliation history available
                             </div>
                         </div>
                     </div>
                 </div>
                 
                 <!-- Graphics and Visualization -->
                 <div class="input-group">
                     <h3 class="section-header" data-section="graphicsSection">
                         <span class="toggle-icon">‚ñ∂</span> üìä Graphics and Visualization
                     </h3>
                     <div id="graphicsSection" class="section-content">
                         <!-- Chart Controls -->
                         <div style="display: flex; gap: 8px; margin-bottom: 15px; flex-wrap: wrap;">
                             <button id="showTimeChartBtn" class="btn btn-primary btn-small">üìà Time Breakdown Chart</button>
                             <button id="showCostChartBtn" class="btn btn-success btn-small">üí∞ Cost Analysis Chart</button>
                             <button id="exportChartBtn" class="btn btn-info btn-small">üìÑ Export Chart</button>
                             <button id="hideChartBtn" class="btn btn-danger btn-small">‚ùå Hide Chart</button>
                         </div>
                         
                         <!-- Chart Container -->
                         <div id="chartContainer" style="display: none; background: white; border: 1px solid #ddd; border-radius: 6px; padding: 20px; margin-bottom: 15px;">
                             <div id="chartTitle" style="text-align: center; font-size: 18px; font-weight: bold; margin-bottom: 15px; color: #495057;"></div>
                             <canvas id="projectChart" width="800" height="400" style="max-width: 100%; height: auto;"></canvas>
                         </div>
                         
                         <!-- Quick Stats Grid -->
                         <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                             <div class="stat-card">
                                 <div class="stat-icon">‚è±Ô∏è</div>
                                 <div class="stat-title">Total Time</div>
                                 <div class="stat-value" id="totalTimeStat">0.0 hrs</div>
                             </div>
                             <div class="stat-card">
                                 <div class="stat-icon">üí∞</div>
                                 <div class="stat-title">Total Cost</div>
                                 <div class="stat-value" id="totalCostStat">$0</div>
                             </div>
                             <div class="stat-card">
                                 <div class="stat-icon">üîå</div>
                                 <div class="stat-title">Cables</div>
                                 <div class="stat-value" id="cablesStat">0</div>
                             </div>
                             <div class="stat-card">
                                 <div class="stat-icon">üîó</div>
                                 <div class="stat-title">Terminations</div>
                                 <div class="stat-value" id="terminationsStat">0</div>
                             </div>
                         </div>
                         
                         <!-- Visualization Options -->
                         <div style="background: #f8f9fa; padding: 15px; border-radius: 6px; border-left: 4px solid #17a2b8;">
                             <h4 style="margin-bottom: 10px; color: #495057;">Visualization Options:</h4>
                             <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                 <label style="display: flex; align-items: center; gap: 5px;">
                                     <input type="checkbox" id="showPercentages" checked>
                                     <span style="color: #495057;">Show Percentages</span>
                                 </label>
                                 <label style="display: flex; align-items: center; gap: 5px;">
                                     <input type="checkbox" id="showValues" checked>
                                     <span style="color: #495057;">Show Values</span>
                                 </label>
                                 <label style="display: flex; align-items: center; gap: 5px;">
                                     <input type="checkbox" id="animateCharts" checked>
                                     <span style="color: #495057;">Animate Charts</span>
                                 </label>
                             </div>
                         </div>
                     </div>
                 </div>
            </div>
            
            <!-- Right Panel: Input Fields -->
            <div class="right-panel">
                <div class="input-grid">
                    <!-- Cable Configuration -->
                    <div class="input-group">
                        <h3 class="section-header expanded" data-section="cableConfig">
                            <span class="toggle-icon">‚ñº</span> üì° Wirelist / Cables
                        </h3>
                        <div id="cableConfig" class="section-content expanded">
                            <div class="toggle-group">
                                <div class="toggle-btn active" data-mode="average">Average Length</div>
                                <div class="toggle-btn" data-mode="calculated">Calculated Quantity and Length</div>
                            </div>
                            
                            <div id="averageLengthMode">
                                <div class="line-item">
                                    <select class="cable-type" data-value="1855">
                                        <option value="1855">1855</option>
                                        <option value="1505">1505</option>
                                        <option value="1694">1694</option>
                                        <option value="cat6">Cat6</option>
                                        <option value="other">Other</option>
                                    </select>
                                    <input type="number" id="numCables" min="1" placeholder="Qty" class="avg-length-input">
                                    <input type="number" id="avgCableLength" min="1" placeholder="Avg Length (ft)" class="avg-length-input">
                                </div>
                            </div>
                            
                            <div id="calculatedLengthMode" style="display: none;">
                                <div id="cableLengths">
                                    <div class="line-item cable-line-item">
                                        <select class="cable-type" data-value="1855">
                                            <option value="1855">1855</option>
                                            <option value="1505">1505</option>
                                            <option value="1694">1694</option>
                                            <option value="cat6">Cat6</option>
                                            <option value="other">Other</option>
                                        </select>
                                        <input type="number" placeholder="Qty" class="cable-qty" min="1" style="width: 60px;">
                                        <input type="number" placeholder="Length" class="cable-length" min="1" style="width: 80px;">
                                        <button class="remove-btn">‚úï</button>
                                    </div>
                                </div>
                                <button class="btn btn-success add-item-btn" data-type="cable">‚ûï Add</button>
                                
                                <!-- Cable Summary Section -->
                                <div id="cableSummary" class="cable-summary" style="display: none;">
                                    <div class="summary-box">
                                        <div class="summary-item">
                                            <span class="summary-label">Total Cables:</span>
                                            <span id="cableTotal" class="summary-value">0</span>
                                        </div>
                                        <div class="summary-item">
                                            <span class="summary-label">Total Length:</span>
                                            <span id="cableLengthTotal" class="summary-value">0 ft</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>



                    <!-- Materials and Equipment -->
                    <div class="input-group">
                        <h3 class="section-header expanded" data-section="materialsEquipment">
                            <span class="toggle-icon">‚ñº</span> üß∞ Supplies and Expendables
                        </h3>
                        <div id="materialsEquipment" class="section-content expanded">
                            <div id="otherMaterials">
                                <div class="line-item">
                                    <input type="text" placeholder="Description" class="other-material-desc" style="flex: 3;">
                                    <input type="number" placeholder="Qty" class="other-material-qty" min="1" value="1" style="width: 60px;">
                                    <div style="position: relative; display: inline-block; width: 100px;">
                                        <span style="position: absolute; left: 5px; top: 50%; transform: translateY(-50%); color: #666; pointer-events: none; z-index: 1;">$</span>
                                        <input type="number" placeholder="Amount" class="other-material-amount" step="1" style="width: 100px; padding-left: 15px;">
                                    </div>
                                    <button class="remove-btn">‚úï</button>
                                </div>
                            </div>
                            <button class="btn btn-success add-item-btn" data-type="other">‚ûï Add</button>
                        </div>
                    </div>

                    <!-- Materials and Hardware -->
                    <!-- <div class="input-group">
                        <h3 class="section-header" data-section="materialsHardware">
                            <span class="toggle-icon">‚ñ∂</span> üèóÔ∏è Materials and Hardware
                        </h3>
                        <div id="materialsHardware" class="section-content">
                            <div id="materialsItems">
                                <div class="line-item">
                                    <input type="text" placeholder="Description" class="material-desc" style="flex: 3;">
                                    <input type="number" placeholder="Qty" class="material-qty" min="1" value="1" style="width: 60px;">
                                    <div style="position: relative; display: inline-block; width: 100px;">
                                        <span style="position: absolute; left: 5px; top: 50%; transform: translateY(-50%); color: #666; pointer-events: none; z-index: 1;">$</span>
                                        <input type="number" placeholder="Cost" class="material-cost" step="1" style="width: 100px; padding-left: 15px;">
                                    </div>
                                    <button class="remove-btn">‚úï</button>
                                </div>
                            </div>
                            <button class="btn btn-success add-item-btn" data-type="material">‚ûï Add</button>
                        </div>
                    </div> -->

                    <!-- Equipment and Tools -->
                    <!-- <div class="input-group">
                        <h3 class="section-header" data-section="equipmentTools">
                            <span class="toggle-icon">‚ñ∂</span> üîß Equipment and Tools
                        </h3>
                        <div id="equipmentTools" class="section-content">
                            <div id="equipmentItems">
                                <div class="line-item">
                                    <input type="text" placeholder="Description" class="equipment-desc" style="flex: 3;">
                                    <input type="number" placeholder="Qty" class="equipment-qty" min="1" value="1" style="width: 60px;">
                                    <div style="position: relative; display: inline-block; width: 100px;">
                                        <span style="position: absolute; left: 5px; top: 50%; transform: translateY(-50%); color: #666; pointer-events: none; z-index: 1;">$</span>
                                        <input type="number" placeholder="Cost" class="equipment-cost" step="1" style="width: 100px; padding-left: 15px;">
                                    </div>
                                    <button class="remove-btn">‚úï</button>
                                </div>
                            </div>
                            <button class="btn btn-success add-item-btn" data-type="equipment">‚ûï Add</button>
                        </div>
                    </div> -->

                    <!-- Shipping and Logistics -->
                    <!-- <div class="input-group">
                        <h3 class="section-header" data-section="shippingLogistics">
                            <span class="toggle-icon">‚ñ∂</span> üöö Shipping and Logistics
                        </h3>
                        <div id="shippingLogistics" class="section-content">
                            <div id="shippingItems">
                                <div class="line-item">
                                    <input type="text" placeholder="Description" class="shipping-desc" style="flex: 3;">
                                    <input type="number" placeholder="Qty" class="shipping-qty" min="1" value="1" style="width: 60px;">
                                    <div style="position: relative; display: inline-block; width: 100px;">
                                        <span style="position: absolute; left: 5px; top: 50%; transform: translateY(-50%); color: #666; pointer-events: none; z-index: 1;">$</span>
                                        <input type="number" placeholder="Cost" class="shipping-cost" step="1" style="width: 100px; padding-left: 15px;">
                                    </div>
                                    <button class="remove-btn">‚úï</button>
                                </div>
                            </div>
                            <button class="btn btn-success add-item-btn" data-type="shipping">‚ûï Add</button>
                        </div>
                    </div> -->

                    <!-- Documentation and Admin -->
                    <!-- <div class="input-group">
                        <h3 class="section-header" data-section="documentationAdmin">
                            <span class="toggle-icon">‚ñ∂</span> üìã Documentation and Admin
                        </h3>
                        <div id="documentationAdmin" class="section-content">
                            <div id="adminItems">
                                <div class="line-item">
                                    <input type="text" placeholder="Description" class="admin-desc" style="flex: 3;">
                                    <input type="number" placeholder="Qty" class="admin-qty" min="1" value="1" style="width: 60px;">
                                    <div style="position: relative; display: inline-block; width: 100px;">
                                        <span style="position: absolute; left: 5px; top: 50%; transform: translateY(-50%); color: #666; pointer-events: none; z-index: 1;">$</span>
                                        <input type="number" placeholder="Cost" class="admin-cost" step="1" style="width: 100px; padding-left: 15px;">
                                    </div>
                                    <button class="remove-btn">‚úï</button>
                                </div>
                            </div>
                            <button class="btn btn-success add-item-btn" data-type="admin">‚ûï Add</button>
                        </div>
                    </div> -->

                    <!-- Vendor Pricing -->
                    <div class="input-group">
                        <h3 class="section-header expanded" data-section="vendorPricing">
                            <span class="toggle-icon">‚ñº</span> üè∑Ô∏è Vendor
                        </h3>
                        <div id="vendorPricing" class="section-content expanded" style="display: block;">
                            <!-- Vendor Orders Subsection -->
                            <div style="margin-bottom: 25px;">
                                <h4 style="margin-bottom: 15px; color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 5px;">üì¶ Orders</h4>
                                <div class="toggle-group">
                                    <div class="toggle-btn active" data-vendor="1">
                                        Vendor 1
                                        <span class="vendor-status active-status">‚óè</span>
                                    </div>
                                    <div class="toggle-btn" data-vendor="2">
                                        Vendor 2
                                        <span class="vendor-status inactive-status">‚óã</span>
                                    </div>
                                    <div class="toggle-btn" data-vendor="3">
                                        Vendor 3
                                        <span class="vendor-status inactive-status">‚óã</span>
                                    </div>
                                </div>
                            
                                <div id="vendor1Details" class="vendor-details">
                                    <div class="vendor-name-row">
                                        <label for="vendor1Name">Vendor 1 Name:</label>
                                        <input type="text" id="vendor1Name" placeholder="Enter vendor name">
                                        <div class="vendor-active-toggle active">
                                            <span>ACTIVE</span>
                                        </div>
                                    </div>
                                    
                                    <h4 style="margin-top: 15px; color: #2c3e50;">Line Items</h4>
                                    <div class="vendor-items">
                                        <div class="line-item">
                                            <input type="text" placeholder="Description/Part #" class="vendor-item-desc" style="flex: 3;">
                                            <input type="number" placeholder="Qty" class="vendor-item-qty" min="1" value="0" style="width: 60px;">
                                            <div style="position: relative; display: inline-block; width: 100px;">
                                                <span style="position: absolute; left: 5px; top: 50%; transform: translateY(-50%); color: #666; pointer-events: none; z-index: 1;">$</span>
                                                <input type="number" placeholder="Cost" class="vendor-item-cost" step="1" value="0" style="width: 100px; padding-left: 15px;">
                                            </div>
                                            <button class="remove-btn">‚úï</button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div id="vendor2Details" class="vendor-details" style="display: none;">
                                    <div class="vendor-name-row">
                                        <label for="vendor2Name">Vendor 2 Name:</label>
                                        <input type="text" id="vendor2Name" placeholder="Enter vendor name">
                                        <div class="vendor-active-toggle inactive">
                                            <span>INACTIVE</span>
                                        </div>
                                    </div>
                                    
                                    <h4 style="margin-top: 15px; color: #2c3e50;">Line Items</h4>
                                    <div class="vendor-items">
                                        <div class="line-item">
                                            <input type="text" placeholder="Description/Part #" class="vendor-item-desc" style="flex: 3;">
                                            <input type="number" placeholder="Qty" class="vendor-item-qty" min="1" value="0" style="width: 60px;">
                                            <div style="position: relative; display: inline-block; width: 100px;">
                                                <span style="position: absolute; left: 5px; top: 50%; transform: translateY(-50%); color: #666; pointer-events: none; z-index: 1;">$</span>
                                                <input type="number" placeholder="Cost" class="vendor-item-cost" step="1" value="0" style="width: 100px; padding-left: 15px;">
                                            </div>
                                            <button class="remove-btn">‚úï</button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div id="vendor3Details" class="vendor-details" style="display: none;">
                                    <div class="vendor-name-row">
                                        <label for="vendor3Name">Vendor 3 Name:</label>
                                        <input type="text" id="vendor3Name" placeholder="Enter vendor name">
                                        <div class="vendor-active-toggle inactive">
                                            <span>INACTIVE</span>
                                        </div>
                                    </div>
                                    
                                    <h4 style="margin-top: 15px; color: #2c3e50;">Line Items</h4>
                                    <div class="vendor-items">
                                        <div class="line-item">
                                            <input type="text" placeholder="Description/Part #" class="vendor-item-desc" style="flex: 3;">
                                            <input type="number" placeholder="Qty" class="vendor-item-qty" min="1" value="0" style="width: 60px;">
                                            <div style="position: relative; display: inline-block; width: 100px;">
                                                <span style="position: absolute; left: 5px; top: 50%; transform: translateY(-50%); color: #666; pointer-events: none; z-index: 1;">$</span>
                                                <input type="number" placeholder="Cost" class="vendor-item-cost" step="1" value="0" style="width: 100px; padding-left: 15px;">
                                            </div>
                                            <button class="remove-btn">‚úï</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Quotes Subsection -->
                            <div style="margin-top: 25px;">
                                <h4 style="margin-bottom: 15px; color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 5px;">üìã Quotes</h4>
                                <div id="vendorQuotes">
                                    <!-- Quotes will be dynamically managed by VendorManager -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Staff Line Items -->
                    <div class="input-group">
                        <h3 class="section-header expanded" data-section="staffLineItems">
                            <span class="toggle-icon">‚ñº</span> üë• Assigned to Staff
                        </h3>
                        <div id="staffLineItems" class="section-content expanded">
                            <div id="staffLineItemsContainer">
                                <div class="line-item">
                                    <select class="staff-desc" style="flex: 2; padding: 4px 8px; border: 1px solid #ced4da; border-radius: 4px; background: white;">
                                        <option value="">Select Staff...</option>
                                    </select>
                                    <input type="text" placeholder="Note" class="staff-note" style="flex: 3;">
                                    <input type="number" placeholder="Hours" class="staff-hours" step="0.1" min="0" style="width: 60px;">
                                    <button class="remove-btn">‚úï</button>
                                </div>
                            </div>
                            <button class="btn btn-success add-item-btn" data-type="staff">‚ûï Add</button>
                        </div>
                    </div>

                    <!-- Setup Configuration -->
                    <div class="input-group">
                        <h3 class="section-header expanded" data-section="setupConfig">
                            <span class="toggle-icon">‚ñº</span> ‚öôÔ∏è Setup
                        </h3>
                        <div id="setupConfig" class="section-content expanded" style="display: block;">
                            
                            <!-- Project Section -->
                            <div style="margin-bottom: 25px;">
                                <h4 style="margin-bottom: 15px; color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 5px;">üìÅ Project</h4>
                                
                                <!-- Action Buttons -->
                                <div style="display: flex; gap: 8px; margin-bottom: 15px; flex-wrap: wrap;">
                                    <button id="exportCsvBtn" class="btn btn-success btn-small">üìä Export CSV</button>
                                    <button id="saveProjectBtn" class="btn btn-primary btn-small">üíæ Save Project</button>
                                    <button id="loadProjectBtn" class="btn btn-warning btn-small">üìÅ Load Project</button>
                                    <button id="projectHistoryBtn" class="btn btn-info btn-small">üìà Project History</button>
                                </div>
                                
                                <div class="setup-grid">
                                    <div class="setup-item">
                                        <label for="projectName">Project Name:</label>
                                        <input type="text" id="projectName" placeholder="Enter project name">
                                    </div>
                                    <div class="setup-item">
                                        <label for="projectDate">Start Date:</label>
                                        <input type="date" id="projectDate">
                                    </div>
                                    <div class="setup-item">
                                        <label for="projectDescription">Description:</label>
                                        <input type="text" id="projectDescription" placeholder="Brief project description">
                                    </div>
                                    <div class="setup-item">
                                        <label for="projectEndDate">End Date:</label>
                                        <input type="date" id="projectEndDate">
                                    </div>
                                    <div class="setup-item">
                                        <label for="projectRevision">Revision:</label>
                                        <div style="display: flex; gap: 8px; align-items: center;">
                                            <input type="text" id="projectRevision" value="1.0" placeholder="1.0" style="flex: 1;">
                                            <button id="incrementRevisionBtn" class="btn btn-primary btn-small">+</button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Project Controls -->
                                <div style="display: flex; gap: 8px; margin-top: 15px; flex-wrap: wrap;">
                                    <button id="resetProjectBtn" class="btn btn-danger btn-small">üîÑ Reset Project</button>
                                    <button id="autoSaveToggle" class="btn btn-secondary btn-small">üíæ Auto-Save: ON</button>
                                </div>
                            </div>
                            

                            
                            <!-- Install Section -->
                            <div style="margin-bottom: 25px;">
                                <h4 style="margin-bottom: 15px; color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 5px;">‚ö° Install</h4>
                                <div class="setup-grid">
                                    <div class="setup-item">
                                        <label for="cableRunTime">Cable Running Time (min/cable):</label>
                                        <input type="number" id="cableRunTime" value="0" min="0" step="0.5">
                                    </div>
                                    <div class="setup-item">
                                        <label for="testingTime">Testing Time (min/cable):</label>
                                        <input type="number" id="testingTime" value="0" min="0" step="0.5">
                                    </div>
                                    <div class="setup-item">
                                        <label for="rackSetupTime">Rack Setup Time (hours):</label>
                                        <input type="number" id="rackSetupTime" value="0" min="0" step="0.5">
                                    </div>
                                    <div class="setup-item">
                                        <label for="labelingTime">Labeling Time (min/cable):</label>
                                        <input type="number" id="labelingTime" value="0" min="0" step="0.1">
                                    </div>
                                    <div class="setup-item">
                                        <label for="cleanupTime">Cleanup Time (hours):</label>
                                        <input type="number" id="cleanupTime" value="0" min="0" step="0.1">
                                    </div>
                                    <div class="setup-item">
                                        <label for="cutoverTime">Cutover Time (hours):</label>
                                        <input type="number" id="cutoverTime" value="0" min="0" step="0.5">
                                    </div>
                                    <div class="setup-item">
                                        <label for="decommissioningTime">Decommissioning Time (hours):</label>
                                        <input type="number" id="decommissioningTime" value="0" min="0" step="0.5">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Labor Section -->
                            <div style="margin-bottom: 25px;">
                                <h4 style="margin-bottom: 15px; color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 5px;">üë∑ Labor</h4>
                                
                                <div class="setup-grid">
                                    <div class="setup-item">
                                        <label for="laborPreset">Labor Preset:</label>
                                        <select id="laborPreset">
                                            <option value="rateA">Rate A ($25/hr)</option>
                                            <option value="rateB">Rate B ($125/hr)</option>
                                            <option value="zeroed">Zeroed Out Equipment Only</option>
                                            <option value="custom">Custom</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <!-- Rate Selection Toggle -->
                                <div class="toggle-group" style="margin-bottom: 15px;">
                                    <div class="toggle-btn active" data-mode="single">Single Rate</div>
                                    <div class="toggle-btn" data-mode="dual">Rate A + Rate B</div>
                                </div>
                                
                                <!-- Single Rate Mode -->
                                <div id="singleLabor" class="setup-grid">
                                    <div class="setup-item">
                                        <label for="numTechnicians"># of Techs:</label>
                                        <input type="number" id="numTechnicians" value="1" min="0">
                                    </div>
                                    <div class="setup-item">
                                        <label for="hourlyRate">Hourly Rate:</label>
                                        <input type="number" id="hourlyRate" value="25" min="0" step="0.01">
                                    </div>
                                    <div class="setup-item">
                                        <label for="workHoursPerDay">Hours Scheduled:</label>
                                        <input type="number" id="workHoursPerDay" value="0" min="0" max="240" step="1">
                                    </div>
                                </div>

                                <!-- Dual Rate Mode -->
                                <div id="dualLabor" class="setup-grid" style="display: none;">
                                    <div class="split-section" style="margin-bottom: 15px;">
                                        <h5 style="margin-bottom: 10px; color: #495057;">üë• Technician Rate A</h5>
                                        <div class="setup-grid">
                                            <div class="setup-item">
                                                <label for="techACount"># of Techs:</label>
                                                <input type="number" id="techACount" value="1" min="0">
                                            </div>
                                            <div class="setup-item">
                                                <label for="techARate">Rate ($/hr):</label>
                                                <input type="number" id="techARate" value="25" min="0" step="0.01">
                                            </div>
                                            <div class="setup-item">
                                                <label for="techAHours">Hours:</label>
                                                <input type="number" id="techAHours" value="0" min="0" max="240" step="1">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="split-section">
                                        <h5 style="margin-bottom: 10px; color: #495057;">üîß Technician Rate B</h5>
                                        <div class="setup-grid">
                                            <div class="setup-item">
                                                <label for="techBCount"># of Techs:</label>
                                                <input type="number" id="techBCount" value="1" min="0">
                                            </div>
                                            <div class="setup-item">
                                                <label for="techBRate">Rate ($/hr):</label>
                                                <input type="number" id="techBRate" value="125" min="0" step="0.01">
                                            </div>
                                            <div class="setup-item">
                                                <label for="techBHours">Hours:</label>
                                                <input type="number" id="techBHours" value="0" min="0" max="240" step="1">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Staff Hours Section -->
                                <div style="background: #fff3cd; padding: 15px; border-radius: 6px; margin-top: 15px; border-left: 4px solid #ffc107;">
                                    <h5 style="margin-bottom: 10px; color: #495057;">Staff Hours (Salary - Not Billable):</h5>
                                    <div class="setup-grid">
                                        <div class="setup-item">
                                            <label for="staffHours">Total Staff Hours:</label>
                                            <input type="number" id="staffHours" value="0" min="0" step="0.1">
                                        </div>
                                    </div>
                                    <p style="font-size: 0.875rem; color: #6c757d; margin-top: 8px;">(Management, coordination, admin time)</p>
                                </div>
                                
                                <!-- Labor Hours Reconciliation -->
                                <div style="background: #d1ecf1; padding: 15px; border-radius: 6px; margin-top: 15px; border-left: 4px solid #17a2b8; color: #1b4d56;">
                                    <h5 style="margin-bottom: 10px; color: #1b4d56;">Labor Hours Reconciliation:</h5>
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                        <span style="color: #1b4d56;">Calculated Required:</span>
                                        <strong id="calculatedHours" style="color: #1b4d56;">0.0 hrs</strong>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                        <span style="color: #1b4d56;">Allocated Total:</span>
                                        <strong id="allocatedHours" style="color: #1b4d56;">0.0 hrs</strong>
                                    </div>
                                    <div id="reconciliationStatus" style="display: none;">
                                        <span style="color: #dc3545; font-weight: bold;">‚ùå Under-allocated (<span id="hoursDifference">0.0 hrs</span>)</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Default Settings Section -->
                            <div>
                                <h4 style="margin-bottom: 15px; color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 5px;">‚öôÔ∏è Default Settings</h4>
                                <div class="setup-grid">
                                    <div class="setup-item">
                                        <label for="terminationsPerCable">Terminations per Cable:</label>
                                        <input type="number" id="terminationsPerCable" value="2" min="1">
                                    </div>
                                    <div class="setup-item">
                                        <label for="timePerTermination">Time per Termination (minutes):</label>
                                        <input type="number" id="timePerTermination" value="1.5" min="0.1" step="0.1">
                                    </div>
                                    <div class="setup-item">
                                        <label for="wasteFactor">Cable Waste Factor (%):</label>
                                        <input type="number" id="wasteFactor" value="7.5" min="0" max="20" step="0.1">
                                    </div>
                                    <div class="setup-item">
                                        <label for="connectorWasteFactor">Connector Waste Factor (%):</label>
                                        <input type="number" id="connectorWasteFactor" value="3.0" min="0" max="20" step="0.1">
                                    </div>
                                    <div class="setup-item">
                                        <label for="spoolLength">Cable Spool Length (feet):</label>
                                        <input type="number" id="spoolLength" value="1000" min="1">
                                    </div>
                                    <div class="setup-item">
                                        <label for="cableCostPerFoot">Cable Cost per Foot ($):</label>
                                        <input type="number" id="cableCostPerFoot" value="0.34" min="0" step="0.01">
                                    </div>
                                    <div class="setup-item">
                                        <label for="terminationCost">Termination Cost per Connector ($):</label>
                                        <input type="number" id="terminationCost" value="2.40" min="0" step="0.01">
                                    </div>
                                </div>
                                <div style="display: flex; gap: 8px; margin-top: 15px; flex-wrap: wrap;">
                                    <button id="saveDefaultSettingsBtn" class="btn btn-primary btn-small">üíæ Save Default Settings</button>
                                    <button id="resetDefaultSettingsBtn" class="btn btn-secondary btn-small">üîÑ Reset Default Settings</button>
                                </div>
                            </div>
                            
                            <!-- Admin Section -->
                            <div style="margin-top: 25px;">
                                <h4 style="margin-bottom: 15px; color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 5px;">üîß Admin</h4>
                                
                                <!-- Staff Description Options Configuration -->
                                <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border: 1px solid #dee2e6;">
                                    <h5 style="margin-bottom: 15px; color: #2c3e50;">üë• Staff Description Options</h5>
                                    <p style="font-size: 0.875rem; color: #6c757d; margin-bottom: 15px;">Configure the dropdown options for staff descriptions in the "Assigned to Staff" section.</p>
                                    
                                    <div id="staffDescriptionOptions" style="margin-bottom: 15px;">
                                        <!-- Options will be dynamically populated here -->
                                    </div>
                                    
                                    <div style="display: flex; gap: 8px; align-items: center; margin-bottom: 15px;">
                                        <input type="text" id="newStaffDescription" placeholder="Enter new description option" style="flex: 1; padding: 6px 10px; border: 1px solid #ced4da; border-radius: 4px;">
                                        <button id="addStaffDescriptionBtn" class="btn btn-success btn-small">‚ûï Add Option</button>
                                    </div>
                                    
                                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                        <button id="saveStaffDescriptionsBtn" class="btn btn-primary btn-small">üíæ Save Options</button>
                                        <button id="resetStaffDescriptionsBtn" class="btn btn-secondary btn-small">üîÑ Reset to Default</button>
                                        <button id="clearStaffDescriptionsBtn" class="btn btn-danger btn-small">üóëÔ∏è Clear All</button>
                                        <button id="populateStaffDescriptionsBtn" class="btn btn-success btn-small">üöÄ Auto Populate</button>
                                    </div>
                                </div>
                                
                                <!-- Clear Data Section -->
                                <div style="margin-bottom: 20px; padding: 15px; background: #fff3cd; border-radius: 8px; border: 1px solid #ffc107; border-left: 4px solid #dc3545;">
                                    <h5 style="margin-bottom: 15px; color: #721c24;">üóëÔ∏è Clear Functions</h5>
                                    <p style="font-size: 0.875rem; color: #856404; margin-bottom: 15px;">This will permanently delete ALL saved data including projects, settings, and history. This action cannot be undone!</p>
                                    
                                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                        <button id="clearDataBtn" class="btn btn-danger btn-small" onclick="confirmClearAllData()" title="Clear all saved data and reset application">üóëÔ∏è Clear All Data</button>
                                        <button id="clearAllDataBtn" class="btn btn-danger btn-small" onclick="
                                            console.log('üóëÔ∏è Clear all data clicked');
                                            if(confirm('Are you sure you want to clear ALL localStorage data? This will reset the entire application.')) {
                                                if(window.calculator && window.calculator.clearAllLocalStorage) { 
                                                    window.calculator.clearAllLocalStorage(); 
                                                } else { 
                                                    localStorage.clear();
                                                    window.location.reload();
                                                }
                                            }
                                        ">üóëÔ∏è Clear All Data</button>
                                    </div>
                                </div>
                                
                                <!-- Debug Buttons -->
                                <div style="display: flex; gap: 8px; margin-bottom: 15px; flex-wrap: wrap;">
                                    <button id="testVendorBtn" class="btn btn-secondary btn-small" onclick="
                                        console.log('üß™ Test button clicked');
                                        console.log('üîç window.vendorManager:', window.vendorManager);
                                        console.log('üîç window.vendorManager.vendors:', window.vendorManager?.vendors);
                                        console.log('üîç All vendor instances:', window._vendorManagerInstances);
                                        if(window.vendorManager) { 
                                            window.vendorManager.addVendorItem(1, 'Test Item', 1, 10); 
                                        } else { 
                                            console.error('Vendor manager not found'); 
                                        }
                                    ">üß™ Test Vendor</button>
                                    <button id="testVendorToggleBtn" class="btn btn-secondary btn-small" onclick="
                                        console.log('üß™ Test vendor toggle clicked');
                                        if(window.vendorManager) { 
                                            window.vendorManager.toggleVendorActive(1); 
                                        } else { 
                                            console.error('Vendor manager not found'); 
                                        }
                                    ">üß™ Test Toggle</button>
                                    <button id="debugVendorBtn" class="btn btn-secondary btn-small" onclick="
                                        console.log('üß™ Debug vendor clicked');
                                        if(window.vendorManager) { 
                                            window.vendorManager.debugVendorState(); 
                                        } else { 
                                            console.error('Vendor manager not found'); 
                                        }
                                    ">üß™ Debug Vendor</button>
                                    <button id="testToggleBtn" class="btn btn-secondary btn-small" onclick="
                                        console.log('üß™ Test toggle clicked');
                                        if(window.vendorManager) { 
                                            window.vendorManager.testVendorToggle(2); 
                                        } else { 
                                            console.error('Vendor manager not found'); 
                                        }
                                    ">üß™ Test Toggle</button>
                                    <button id="testInactiveVendorBtn" class="btn btn-secondary btn-small" onclick="
                                        console.log('üß™ Test inactive vendor scenario clicked');
                                        if(window.testInactiveVendorScenario) { 
                                            window.testInactiveVendorScenario(); 
                                        } else { 
                                            console.error('Test function not found'); 
                                        }
                                    ">üß™ Test Inactive Vendor</button>
                                    <button id="testUserScenarioBtn" class="btn btn-secondary btn-small" onclick="
                                        console.log('üß™ Testing user scenario: vendor with items but inactive');
                                        if(window.vendorManager) {
                                            // Set up the scenario: Vendor 1 has items but is inactive
                                            window.vendorManager.vendors[1] = {
                                                name: 'Test Vendor',
                                                items: [
                                                    { id: 1, description: 'Test Item', qty: 10, cost: 50 }
                                                ],
                                                active: false
                                            };
                                            console.log('üß™ Set up vendor 1 with items but inactive');
                                            console.log('üß™ Vendor 1 items total value: 500');
                                            console.log('üß™ Vendor 1 active status:', window.vendorManager.vendors[1].active);
                                            
                                            // Trigger calculation
                                            if(window.projectCalculator) {
                                                window.projectCalculator.calculate();
                                                console.log('üß™ Calculation triggered');
                                            }
                                        }
                                    ">üß™ Test User Scenario</button>
                                    <button id="testVendorQuotesBtn" class="btn btn-secondary btn-small" onclick="
                                        console.log('üß™ Testing vendor quotes functionality...');
                                        if(window.vendorManager) {
                                            console.log('‚úÖ VendorManager available');
                                            window.vendorManager.addVendorQuote('Test Vendor', 'Test Item', '', 'Q001', 1000, 'pending');
                                            console.log('‚úÖ Test quote added');
                                            window.vendorManager.updateVendorQuotesUI();
                                            console.log('‚úÖ Vendor quotes UI updated');
                                            
                                            const vendorQuotesContainer = document.getElementById('vendorQuotes');
                                            if (vendorQuotesContainer) {
                                                const quoteElements = vendorQuotesContainer.querySelectorAll('.vendor-quote');
                                                console.log(`üîç Found ${quoteElements.length} quote elements`);
                                                quoteElements.forEach((element, index) => {
                                                    const statusDropdown = element.querySelector('.vendor-quote-status');
                                                    console.log(`Quote ${index + 1} status dropdown exists: ${!!statusDropdown}`);
                                                    if (statusDropdown) {
                                                        const options = statusDropdown.querySelectorAll('option');
                                                        console.log(`Quote ${index + 1} has ${options.length} status options`);
                                                    }
                                                });
                                            }
                                            
                                            const notification = document.createElement('div');
                                            notification.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #28a745; color: white; padding: 12px 20px; border-radius: 6px; font-weight: bold; z-index: 10000; box-shadow: 0 4px 12px rgba(0,0,0,0.15);';
                                            notification.textContent = 'Vendor quotes test completed! Check console for details.';
                                            document.body.appendChild(notification);
                                            setTimeout(() => { if (notification.parentNode) { notification.remove(); } }, 3000);
                                        } else {
                                            console.error('‚ùå VendorManager not available');
                                            const errorNotification = document.createElement('div');
                                            errorNotification.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #dc3545; color: white; padding: 12px 20px; border-radius: 6px; font-weight: bold; z-index: 10000; box-shadow: 0 4px 12px rgba(0,0,0,0.15);';
                                            errorNotification.textContent = 'VendorManager not available!';
                                            document.body.appendChild(errorNotification);
                                            setTimeout(() => { if (errorNotification.parentNode) { errorNotification.remove(); } }, 3000);
                                        }
                                    ">üß™ Test Vendor Quotes</button>
                                    
                                    <button id="testVendorIndicatorsBtn" class="btn btn-secondary btn-small" onclick="
                            console.log('üß™ Testing vendor active/inactive indicators...');
                            if(window.vendorManager) {
                                console.log('‚úÖ VendorManager available');
                                console.log('üîç Current vendor states:', window.vendorManager.vendors);
                                
                                // Check all vendor indicators
                                for (let i = 1; i <= 3; i++) {
                                    const vendorDetails = document.getElementById(`vendor${i}Details`);
                                    if (vendorDetails) {
                                        const toggle = vendorDetails.querySelector('.vendor-active-toggle');
                                        if (toggle) {
                                            const span = toggle.querySelector('span');
                                            console.log(`üîç Vendor ${i} indicator:`, {
                                                element: toggle,
                                                classes: toggle.className,
                                                text: span ? span.textContent : 'No span found',
                                                visible: vendorDetails.style.display !== 'none',
                                                computedStyle: {
                                                    backgroundColor: getComputedStyle(toggle).backgroundColor,
                                                    color: getComputedStyle(toggle).color,
                                                    display: getComputedStyle(toggle).display
                                                }
                                            });
                                        } else {
                                            console.warn(`‚ö†Ô∏è Vendor ${i} toggle not found`);
                                        }
                                    } else {
                                        console.warn(`‚ö†Ô∏è Vendor ${i} details not found`);
                                    }
                                }
                                
                                // Test toggling vendor 2
                                console.log('üß™ Testing toggle of vendor 2...');
                                window.vendorManager.toggleVendorActive(2);
                                
                                const notification = document.createElement('div');
                                notification.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #28a745; color: white; padding: 12px 20px; border-radius: 6px; font-weight: bold; z-index: 10000; box-shadow: 0 4px 12px rgba(0,0,0,0.15);';
                                notification.textContent = 'Vendor indicators test completed! Check console for details.';
                                document.body.appendChild(notification);
                                setTimeout(() => { if (notification.parentNode) { notification.remove(); } }, 3000);
                            } else {
                                console.error('‚ùå VendorManager not available');
                                const errorNotification = document.createElement('div');
                                errorNotification.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #dc3545; color: white; padding: 12px 20px; border-radius: 6px; font-weight: bold; z-index: 10000; box-shadow: 0 4px 12px rgba(0,0,0,0.15);';
                                errorNotification.textContent = 'VendorManager not available!';
                                document.body.appendChild(errorNotification);
                                setTimeout(() => { if (errorNotification.parentNode) { errorNotification.remove(); } }, 3000);
                            }
                        ">üß™ Test Vendor Indicators</button>
                        
                                    <button id="forceUpdateVendorIndicatorsBtn" class="btn btn-warning btn-small" onclick="
                            console.log('üîß Force updating vendor indicators...');
                            if(window.vendorManager && window.vendorManager.forceUpdateVendorIndicators) {
                                window.vendorManager.forceUpdateVendorIndicators();
                                
                                const notification = document.createElement('div');
                                notification.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #ffc107; color: black; padding: 12px 20px; border-radius: 6px; font-weight: bold; z-index: 10000; box-shadow: 0 4px 12px rgba(0,0,0,0.15);';
                                notification.textContent = 'Vendor indicators force updated! Look for yellow highlights.';
                                document.body.appendChild(notification);
                                setTimeout(() => { if (notification.parentNode) { notification.remove(); } }, 3000);
                            } else {
                                console.error('‚ùå VendorManager or forceUpdateVendorIndicators not available');
                                const errorNotification = document.createElement('div');
                                errorNotification.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #dc3545; color: white; padding: 12px 20px; border-radius: 6px; font-weight: bold; z-index: 10000; box-shadow: 0 4px 12px rgba(0,0,0,0.15);';
                                errorNotification.textContent = 'Force update method not available!';
                                document.body.appendChild(errorNotification);
                                setTimeout(() => { if (errorNotification.parentNode) { errorNotification.remove(); } }, 3000);
                            }
                        ">üîß Force Update Indicators</button>
                                    
                                    <button id="testVendorPersistenceBtn" class="btn btn-info btn-small" onclick="
                                        console.log('üß™ Testing vendor persistence...');
                                        if(window.vendorManager && window.calculator) {
                                            // Test saving vendor data
                                            console.log('üîß Current vendor state before save:', window.vendorManager.vendors);
                                            window.calculator.saveValues();
                                            console.log('‚úÖ Vendor data saved');
                                            
                                            // Test loading vendor data
                                            setTimeout(() => {
                                                console.log('üîß Testing vendor data persistence...');
                                                const saved = localStorage.getItem('kgoProjectCalculator');
                                                if (saved) {
                                                    const formData = JSON.parse(saved);
                                                    console.log('üîç Saved vendor data:', formData.lineItems?.vendorQuotes);
                                                }
                                                
                                                // Force reload vendor data
                                                if (formData.lineItems?.vendorQuotes) {
                                                    window.vendorManager.loadState(formData.lineItems.vendorQuotes);
                                                    console.log('‚úÖ Vendor data reloaded');
                                                }
                                            }, 100);
                                            
                                            const notification = document.createElement('div');
                                            notification.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #17a2b8; color: white; padding: 12px 20px; border-radius: 6px; font-weight: bold; z-index: 10000; box-shadow: 0 4px 12px rgba(0,0,0,0.15);';
                                            notification.textContent = 'Vendor persistence test completed! Check console for details.';
                                            document.body.appendChild(notification);
                                            setTimeout(() => { if (notification.parentNode) { notification.remove(); } }, 3000);
                                        } else {
                                            console.error('‚ùå VendorManager or Calculator not available');
                                            const errorNotification = document.createElement('div');
                                            errorNotification.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #dc3545; color: white; padding: 12px 20px; border-radius: 6px; font-weight: bold; z-index: 10000; box-shadow: 0 4px 12px rgba(0,0,0,0.15);';
                                            errorNotification.textContent = 'VendorManager or Calculator not available!';
                                            document.body.appendChild(errorNotification);
                                            setTimeout(() => { if (errorNotification.parentNode) { errorNotification.remove(); } }, 3000);
                                        }
                                    ">üß™ Test Vendor Persistence</button>
                                    
                                    <button id="testVendor3PersistenceBtn" class="btn btn-danger btn-small" onclick="
                                        console.log('üß™ Testing vendor 3 persistence specifically...');
                                        if(window.vendorManager && window.calculator) {
                                            // Test vendor 3 name change
                                            console.log('üîß Current vendor 3 state:', window.vendorManager.vendors[3]);
                                            const testName = 'TEST_VENDOR_3_' + Date.now();
                                            window.vendorManager.updateVendorName(3, testName);
                                            console.log('üîß Vendor 3 name changed to:', testName);
                                            console.log('üîß Vendor 3 state after name change:', window.vendorManager.vendors[3]);
                                            
                                            // Test vendor 3 active status change
                                            const currentActive = window.vendorManager.vendors[3].active;
                                            window.vendorManager.toggleVendorActive(3);
                                            console.log('üîß Vendor 3 active status toggled from', currentActive, 'to', window.vendorManager.vendors[3].active);
                                            
                                            // Force save
                                            window.calculator.saveValues();
                                            console.log('‚úÖ Vendor 3 data saved');
                                            
                                            // Test reload after a delay
                                            setTimeout(() => {
                                                console.log('üîß Testing vendor 3 data reload...');
                                                const saved = localStorage.getItem('kgoProjectCalculator');
                                                if (saved) {
                                                    const formData = JSON.parse(saved);
                                                    console.log('üîç Saved vendor 3 data:', formData.lineItems?.vendorQuotes?.vendors?.[3]);
                                                    
                                                    // Force reload vendor data
                                                    if (formData.lineItems?.vendorQuotes) {
                                                        window.vendorManager.loadState(formData.lineItems.vendorQuotes);
                                                        console.log('‚úÖ Vendor 3 data reloaded');
                                                        console.log('üîß Vendor 3 state after reload:', window.vendorManager.vendors[3]);
                                                    }
                                                }
                                            }, 100);
                                            
                                            const notification = document.createElement('div');
                                            notification.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #dc3545; color: white; padding: 12px 20px; border-radius: 6px; font-weight: bold; z-index: 10000; box-shadow: 0 4px 12px rgba(0,0,0,0.15);';
                                            notification.textContent = 'Vendor 3 persistence test completed! Check console for details.';
                                            document.body.appendChild(notification);
                                            setTimeout(() => { if (notification.parentNode) { notification.remove(); } }, 3000);
                                        } else {
                                            console.error('‚ùå VendorManager or Calculator not available');
                                            const errorNotification = document.createElement('div');
                                            errorNotification.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #dc3545; color: white; padding: 12px 20px; border-radius: 6px; font-weight: bold; z-index: 10000; box-shadow: 0 4px 12px rgba(0,0,0,0.15);';
                                            errorNotification.textContent = 'VendorManager or Calculator not available!';
                                            document.body.appendChild(errorNotification);
                                            setTimeout(() => { if (errorNotification.parentNode) { errorNotification.remove(); } }, 3000);
                                        }
                                    ">üß™ Test Vendor 3 Persistence</button>
                                    

                                    <button id="checkCableItemsBtn" class="btn btn-info btn-small" onclick="
                                        console.log('üîç Check cable items clicked');
                                        const saved = localStorage.getItem('kgoCableLineItems');
                                        if(saved) {
                                            const lineItems = JSON.parse(saved);
                                            console.log('üìÇ Current cable line items in localStorage:', lineItems);
                                            alert('Cable line items in localStorage: ' + JSON.stringify(lineItems, null, 2));
                                        } else {
                                            console.log('üìÇ No cable line items found in localStorage');
                                            alert('No cable line items found in localStorage');
                                        }
                                    ">üîç Check Cable Items</button>
                                    <button id="clearCableItemsBtn" class="btn btn-warning btn-small" onclick="
                                        console.log('üóëÔ∏è Clear cable items clicked');
                                        if(window.calculator && window.calculator.clearCableLineItems) { 
                                            window.calculator.clearCableLineItems(); 
                                            console.log('‚úÖ Cable line items cleared');
                                        } else { 
                                            console.error('Calculator or clearCableLineItems method not found'); 
                                        }
                                    ">üóëÔ∏è Clear Cable Items</button>
                                    <button id="testHardcodedFixBtn" class="btn btn-danger btn-small" onclick="
                                        console.log('üß™ Testing hardcoded values fix...');
                                        
                                        // Check current localStorage state
                                        const cableLineItems = localStorage.getItem('kgoCableLineItems');
                                        const autoSavedProject = localStorage.getItem('autoSavedProject');
                                        
                                        console.log('üîç Current kgoCableLineItems:', cableLineItems);
                                        console.log('üîç Current autoSavedProject exists:', !!autoSavedProject);
                                        
                                        // Test the fix by calling clearHardcodedValues
                                        if(window.kgoCalculator && window.kgoCalculator.clearHardcodedValues) {
                                            window.kgoCalculator.clearHardcodedValues();
                                            console.log('‚úÖ clearHardcodedValues called');
                                        } else {
                                            console.error('kgoCalculator or clearHardcodedValues method not found');
                                        }
                                        
                                        // Check state after fix
                                        const cableLineItemsAfter = localStorage.getItem('kgoCableLineItems');
                                        const autoSavedProjectAfter = localStorage.getItem('autoSavedProject');
                                        
                                        console.log('üîç kgoCableLineItems after fix:', cableLineItemsAfter);
                                        console.log('üîç autoSavedProject after fix exists:', !!autoSavedProjectAfter);
                                        
                                        // Show results
                                        const results = {
                                            before: {
                                                cableLineItems: cableLineItems,
                                                autoSavedProject: !!autoSavedProject
                                            },
                                            after: {
                                                cableLineItems: cableLineItemsAfter,
                                                autoSavedProject: !!autoSavedProjectAfter
                                            }
                                        };
                                        
                                        console.log('üìä Test results:', results);
                                        alert('Hardcoded values fix test completed! Check console for details.\n\nResults: ' + JSON.stringify(results, null, 2));
                                    ">üß™ Test Hardcoded Fix</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div id="helpModal" class="help-modal" style="display: none;">
        <div class="help-modal-content">
            <div class="help-modal-header">
                <h3 id="helpModalTitle">Help Guide</h3>
                <button id="closeHelpBtn" style="background: #e74c3c; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">‚úï</button>
            </div>
            <div class="help-modal-body" id="helpModalBody">
                <!-- Content will be dynamically loaded -->
            </div>
        </div>
    </div>

    <!-- Hidden file input for project loading -->
    <input type="file" id="projectFile" accept=".json" style="display: none;">

    <!-- Section initialization script -->
    <script>
        // Initialize sections with proper state
        function initializeSections() {
            const headers = document.querySelectorAll('.section-header');
            headers.forEach(header => {
                const sectionId = header.getAttribute('data-section');
                if (!sectionId) return;
                
                const content = document.getElementById(sectionId);
                if (!content) return;
                
                // Set initial state based on existing classes
                const isExpanded = header.classList.contains('expanded');
                content.style.display = isExpanded ? 'block' : 'none';
                const icon = header.querySelector('.toggle-icon');
                if (icon) icon.textContent = isExpanded ? '‚ñº' : '‚ñ∂';
                
                // Make sure header is clickable
                header.style.cursor = 'pointer';
            });
        }
        
        // Initialize when DOM is ready
        if (document.readyState !== 'loading') {
            initializeSections();
        } else {
            document.addEventListener('DOMContentLoaded', initializeSections);
        }
    </script>

    <!-- External JavaScript Modules -->
    <script type="module" src="js/main.js?v=1.1"></script>
    
    <!-- Fallback refresh function in case module loading fails -->
    <script>
        // Fallback refresh function
        if (typeof window.refreshAll === 'undefined') {
            window.refreshAll = function() {
                console.log('üîÑ Fallback refresh function called...');
                
                try {
                    // Force calculator to recalculate everything
                    if (window.calculator) {
                        console.log('üîÑ Forcing calculator recalculation...');
                        window.calculator.calculate();
                        window.calculator.updateResults();
                    }
                    
                    // Force key calculation inputs to trigger updates
                    console.log('üîÑ Triggering key calculation inputs...');
                    const keyInputs = [
                        'terminationsPerCable',
                        'timePerTermination', 
                        'wasteFactor',
                        'connectorWasteFactor',
                        'spoolLength',
                        'cableCostPerFoot',
                        'terminationCost',
                        'laborForStaff'
                    ];
                    
                    keyInputs.forEach(inputId => {
                        const input = document.getElementById(inputId);
                        if (input) {
                            console.log(`üîÑ Triggering ${inputId}...`);
                            input.dispatchEvent(new Event('input', { bubbles: true }));
                            input.dispatchEvent(new Event('change', { bubbles: true }));
                        }
                    });
                    
                    // Also trigger any cable line item inputs
                    const cableInputs = document.querySelectorAll('.cable-line-item input');
                    cableInputs.forEach(input => {
                        input.dispatchEvent(new Event('input', { bubbles: true }));
                        input.dispatchEvent(new Event('change', { bubbles: true }));
                    });
                    
                    // Trigger staff line item inputs
                    const staffInputs = document.querySelectorAll('.staff-line-item input');
                    staffInputs.forEach(input => {
                        input.dispatchEvent(new Event('input', { bubbles: true }));
                        input.dispatchEvent(new Event('change', { bubbles: true }));
                    });
                    
                    // Trigger supplies line item inputs
                    const suppliesInputs = document.querySelectorAll('.supplies-line-item input');
                    suppliesInputs.forEach(input => {
                        input.dispatchEvent(new Event('input', { bubbles: true }));
                        input.dispatchEvent(new Event('change', { bubbles: true }));
                    });
                    
                    // Force vendor manager to update if it exists
                    if (window.vendorManager) {
                        console.log('üîÑ Updating vendor data...');
                        if (window.vendorManager.calculateVendorQuotesTotal) {
                            window.vendorManager.calculateVendorQuotesTotal();
                        }
                        if (window.vendorManager.calculateActiveVendorTotal) {
                            window.vendorManager.calculateActiveVendorTotal();
                        }
                        if (window.vendorManager.updateVendorUI) {
                            window.vendorManager.updateVendorUI();
                        }
                        if (window.vendorManager.updateVendorQuotesUI) {
                            window.vendorManager.updateVendorQuotesUI();
                        }
                    }
                    
                    // Update staff description dropdowns if UIUtils exists
                    if (window.UIUtils && window.UIUtils.updateAllStaffDescriptionDropdowns) {
                        console.log('üîÑ Updating staff description dropdowns...');
                        window.UIUtils.updateAllStaffDescriptionDropdowns();
                    }
                    
                    // Force a final calculation update
                    if (window.calculator) {
                        console.log('üîÑ Final calculation update...');
                        window.calculator.calculate();
                        window.calculator.updateResults();
                    }
                    
                    console.log('‚úÖ All elements refreshed successfully');
                    
                    // Show success notification
                    const notification = document.createElement('div');
                    notification.style.cssText = `
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        background: #28a745;
                        color: white;
                        padding: 12px 20px;
                        border-radius: 6px;
                        font-weight: bold;
                        z-index: 10000;
                        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                    `;
                    notification.textContent = 'All calculations refreshed!';
                    document.body.appendChild(notification);
                    
                    // Remove notification after 3 seconds
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.remove();
                        }
                    }, 3000);
                    
                } catch (error) {
                    console.error('‚ùå Error during refresh:', error);
                    
                    // Show error notification
                    const errorNotification = document.createElement('div');
                    errorNotification.style.cssText = `
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        background: #dc3545;
                        color: white;
                        padding: 12px 20px;
                        border-radius: 6px;
                        font-weight: bold;
                        z-index: 10000;
                        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                    `;
                    errorNotification.textContent = 'Refresh failed: ' + error.message;
                    document.body.appendChild(errorNotification);
                    
                    // Remove error notification after 5 seconds
                    setTimeout(() => {
                        if (errorNotification.parentNode) {
                            errorNotification.remove();
                        }
                    }, 5000);
                }
            };
            console.log('‚úÖ Fallback refreshAll function defined');
        }
        

    </script>
</body>
</html> 